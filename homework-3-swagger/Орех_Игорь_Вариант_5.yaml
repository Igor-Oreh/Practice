openapi: 3.0.0
info:
  title: Cinema API
  version: 1.0.0
  description: API кинотеатра
tags:
  - name: Movies
    description: Операции с фильмами
  - name: Sessions
    description: Операции с сеансами
  - name: Tickets
    description: Операции с билетами
  - name: Users
    description: Операции с пользователями
paths:
  /v1/movies:
    get:
      tags: 
        - Movies
      summary: Получение списка фильмов
      description: Возвращает список всех доступных фильмов
      parameters:
        - in: query
          name: filter
          schema:
            type: string
          required: false
          description: Фильтры по фильмам
        - in: query
          name: start
          schema:
            type: integer
            minimum: 0
          required: false
          description: Номер фильма, с которого начать ответ
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
          required: false
          description: Максимальное число возвращаемых фильмов
        
      responses:
        '200':
          description: Список фильмов возвращен успешно
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Movie'
        '400':
          description: Введены неверные фильтры по фильмам
        '404':
          description: Фильмы в диапазоне не найдены
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/movies/{movieId}/rating:
    post:
      tags:
        - Movies
      summary: Оценка фильма пользователем
      description: Пользователь ставит оценку фильму от 1 до 10
      parameters:
        - in: path
          name: movieId
          schema:
            type: integer
            format: int64
          required: true
          description: ID фильма
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userKey: 
                  type: string
                  description: Ключ авторизации пользователя
                rating:
                  type: integer
                  minimum: 1
                  maximum: 10
                  description: Оценка от 1 до 10
                comment:
                  type: string
                  maxLength: 500
                  description: Комментарий к оценке
              required:
                - userKey
                - rating
      responses:
        '201':
          description: Оценка добавлена успешно
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rating'
        '400':
          description: Неверная оценка или пользователь уже оценил фильм
        '404':
          description: Фильм не найден
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      
  /v1/sessions:
    get:
      tags:
        - Sessions
      summary: Получение расписания сеансов
      description: Возвращает список всех доступных сеансов по дате и, id, фильтрам в порядке даты-времени проведения
      parameters:
        - in: query
          name: date
          schema:
            type: string
            format: date
          required: false
          description: Дата сеанса
        - in: query
          name: filter
          schema:
            type: string
          required: false
          description: Фильтры по фильмам
        - in: query
          name: movieId
          schema:
            type: integer
            format: int64
          required: false
          description: Фильтр по id фильма
        - in: query
          name: start
          schema:
            type: integer
            minimum: 0
          required: false
          description: Номер первого возвращаемого сеанса
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
          required: false
          description: Максимальное число возвращаемых сеансов
      responses:
        '200':
          description: Расписание сеансов возвращено успешно
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Session'
        '400':
          description: Параметры введены неверно
        '404':
          description: Сеансы в диапазоне не найдены
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/sessions/{sessionId}/seats:
    get:
      tags:
       - Sessions
      summary: Получение списка мест в зале
      description: Возвращает список мест в зале для указанного сеанса
      parameters:
        - in: path
          name: sessionId
          schema:
            type: integer
            format: int64
          required: true
          description: id сеанса
      responses:
        '200':
          description: Список мест в зале возвращен успешно
          content:
            application/json:
              schema:
                type: object
                properties:
                  session:
                    $ref: '#/components/schemas/Session'
                  seats:
                    type: array
                    items:
                      type: string
                    description: Список мест
                  isAvailable:
                    type: array
                    items:
                      type: boolean
                    description: Информация о свободности мест
                  seatPricing:
                    type: array
                    items:
                      type: integer
                    description: Информация о ценах на места
        '400':
          description: Введен неверный id сеанса
        '404':
          description: Сеанс не найден
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/tickets:
    post:
      tags:
        - Ticket
      summary: Покупка билета
      description: Покупка билета
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userKey: 
                  type: string
                sessionID:
                  type: integer
                seatNumber:
                  type: integer
              required:
                - userKey
                - sessionID
                - seatNumber
      responses:
        '201':
          description: Билет приобретен успешно
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
        '404':
          description: Ошибка существования ключа или сеанса
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /v1/tickets/{ticketId}:
    get:
      tags:
       - Ticket
      summary: Получение электронного билета
      description: Возвращает полную информацию о билете по его id.
      parameters:
        - in: path
          name: ticketId
          required: true
          schema:
            type: integer
            format: int64
        - in: query
          name: userKey
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Электронный билет получен успешно
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
        '404':
          description: Билет не найден
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      tags:
        - Ticket
      summary: Отмена билета
      description: Изменение статуса билета на CANCELLED
      parameters:
        - in: path
          name: ticketId
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [CANCELLED]
              required:
                - status
              additionalProperties: false
      responses:
        '200':
          description: Билет успешно отменен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
        '400':
          description: Неверный статус или билет уже отменен
        '404':
          description: Билет не найден
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /v1/users/register:
    post:
      tags:
        - User
      summary: Регистрация нового пользователя
      description: Отправляет информацию для создания нового пользователя на сайт
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '201':
          description: Пользователь успешно создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Логин пользователя занят
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/users/login:
    post:
      tags:
        - User
      summary: Вход пользователя в систему
      description: Ввод пользователя в систему
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
              required:
                - email
                - password
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                type: string
                description: userKey
        '400':
          description: Неверный логин/пароль
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/users/logout:
    get:
      tags:
        - User
      summary: Выход пользователя из системы
      description: Выводит текущего пользователя из системы
      responses:
        '200':
          description: Успешный выход из системы
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/users/{userId}/tickets:
    get:
      tags:
        - User
      summary: Получение билетов пользователя
      description: Возвращает список активных билетов пользователя
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: integer
          description: Идентификатор пользователя
        - in: query
          name: userKey
          required: true
          schema:
            type: string
          description: Идентификатор пользователя
        - in: query
          name: start
          schema:
            type: integer
            minimum: 0
          required: false
          description: Номер билета, с которого начать ответ
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
          required: false
          description: Максимальное число возвращаемых фильмов
      responses:
        '200':
          description: Список билетов пользователя
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticket'
        '404':
          description: Пользователь не найден
        default:
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"


components:
  schemas:
    Movie:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
          readOnly: true
        title:
          type: string
          maxLength: 255
          example: "Аватар: Путь воды"
        description:
          type: string
          example: "Фантастический фильм о приключениях в мире Пандоры"
        duration:
          type: integer
          format: int32
          minimum: 1
          example: 192
          description: Длительность фильма в минутах
        genre:
          type: string
          example: "Фантастика"
          description: Жанр фильма
        director:
          type: string
          example: "Джеймс Кэмерон"
        cast:
          type: array
          items:
            type: string
          example: ["Сэм Уортингтон", "Зои Салдана", "Сигурни Уивер"]
        posterUrl:
          type: string
          format: uri
          example: "https://example.com/posters/avatar2.jpg"
        releaseDate:
          type: string
          format: date
          example: "2022-12-15"
        ageRating:
          type: string
          maxLength: 10
          example: "12+"
          description: Возрастное ограничение
        rating:
          type: integer
          minimum: 1
          maximum: 10
          description: Оценка фильма
        isActive:
          type: boolean
          example: true
          description: Активен ли фильм для показа
        createdAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-01-15T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-01-15T10:30:00Z"
      required:
        - title
        - duration
        - genre
        - ageRating

    Session:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 123
          readOnly: true
        movieId:
          type: integer
          format: int64
          example: 1
          description: Идентификатор фильма
        movie:
          $ref: '#/components/schemas/Movie'
          readOnly: true
          description: Объект фильма (только для чтения)
        startTime:
          type: string
          format: date-time
          example: "2024-12-15T19:30:00Z"
          description: Дата и время начала сеанса
        endTime:
          type: string
          format: date-time
          example: "2024-12-15T22:42:00Z"
          readOnly: true
          description: Расчетное время окончания сеанса
        hall:
          type: string
          example: "Зал 1"
          description: Название кинозала
        hallCapacity:
          type: integer
          example: 150
          readOnly: true
          description: Вместимость зала
        availableSeats:
          type: integer
          example: 45
          readOnly: true
          description: Количество свободных мест
        basePrice:
          type: number
          format: double
          minimum: 0
          example: 7.5
          description: Базовая цена билета
        format:
          type: string
          enum: ["2D", "3D", "IMAX", "4DX"]
          example: "3D"
          description: Формат показа
        language:
          type: string
          example: "русский"
          description: Язык озвучки
        subtitles:
          type: boolean
          example: false
          description: Наличие субтитров
        createdAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-01-15T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-01-15T10:30:00Z"
      required:
        - movieId
        - startTime
        - hall
        - basePrice
        - format

    Ticket:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1001
          readOnly: true
        sessionId:
          type: integer
          format: int64
          example: 123
          description: Идентификатор сеанса
        session:
          $ref: '#/components/schemas/Session'
          readOnly: true
          description: Объект сеанса (только для чтения)
        userId:
          type: integer
          format: int64
          example: 456
          description: Идентификатор пользователя
        user:
          $ref: '#/components/schemas/User'
          readOnly: true
          description: Объект пользователя (только для чтения)
        seatNumber:
          type: string
          pattern: '^[A-Z][0-9]+$'
          minLength: 2
          maxLength: 4
          example: "A15"
          description: Номер места в зале
        rowNumber:
          type: integer
          example: 1
          readOnly: true
          description: Номер ряда
        purchaseDateTime:
          type: string
          format: date-time
          example: "2024-12-10T14:25:30Z"
          readOnly: true
          description: Дата и время покупки билета
        price:
          type: number
          format: double
          minimum: 0
          example: 9.99
          readOnly: true
          description: Фактическая цена покупки
        status:
          type: string
          enum: ["ACTIVE", "CANCELLED", "USED"]
          example: "ACTIVE"
          default: "ACTIVE"
          description: Статус билета
        qrCode:
          type: string
          format: byte
          readOnly: true
          example: "base64encodedqrcode"
          description: QR-код билета
        cancellationReason:
          type: string
          example: "Изменение планов"
          description: Причина отмены (если применимо)
        cancelledAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-10T15:30:00Z"
          description: Дата и время отмены
        createdAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-10T14:25:30Z"
        updatedAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-10T14:25:30Z"
      required:
        - sessionId
        - userId
        - seatNumber

    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 456
          readOnly: true
        email:
          type: string
          format: email
          example: "ivan.ivanov@example.com"
          description: Email адрес для входа и уведомлений
        password:
          type: string
          minLength: 6
          writeOnly: true
          example: "securePassword123"
          description: Пароль (только для записи)
        firstName:
          type: string
          example: "Иван"
          description: Имя пользователя
        lastName:
          type: string
          example: "Иванов"
          description: Фамилия пользователя
        phoneNumber:
          type: string
          pattern: '^\+[1-9]\d{1,14}$'
          example: "+375291234567"
          description: Номер телефона в международном формате
        dateOfBirth:
          type: string
          format: date
          example: "1990-05-15"
          description: Дата рождения
        registrationDate:
          type: string
          format: date-time
          example: "2024-01-10T12:00:00Z"
          readOnly: true
          description: Дата и время регистрации
        lastLogin:
          type: string
          format: date-time
          example: "2024-12-10T14:20:00Z"
          readOnly: true
          description: Дата и время последнего входа
        isActive:
          type: boolean
          example: true
          default: true
          description: Активен ли пользователь
        preferences:
          type: object
          properties:
            notifications:
              type: boolean
              example: true
              description: Получать уведомления
            newsletter:
              type: boolean
              example: false
              description: Подписка на рассылку
            favoriteGenres:
              type: array
              items:
                type: string
              example: ["Фантастика", "Драма"]
          description: Настройки пользователя
        userKey:
          type: string
          example: "user_abc123def456"
          readOnly: true
          description: Уникальный ключ пользователя для API
        createdAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-01-10T12:00:00Z"
        updatedAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-10T14:20:00Z"
      required:
        - email
        - password
        - firstName
        - lastName
        - phoneNumber

    Error:
      type: object
      properties:
        error:
          type: string
          description: Код ошибки
        message:
          type: string
          description: Сообщение об ошибке

    SeatInfo:
      type: object
      properties:
        seatNumber:
          type: string
          example: "A15"
        row:
          type: integer
          example: 1
        section:
          type: string
          example: "parterre"
        type:
          type: string
          enum: ["standard", "vip", "disabled"]
          example: "standard"
        price:
          type: number
          format: double
          example: 9.99
        isAvailable:
          type: boolean
          example: true
        isWheelchairAccessible:
          type: boolean
          example: false

    HallLayout:
      type: object
      properties:
        hallName:
          type: string
          example: "Зал 1"
        totalSeats:
          type: integer
          example: 150
        rows:
          type: integer
          example: 10
        seatsPerRow:
          type: integer
          example: 15
        sections:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                example: "parterre"
              startRow:
                type: integer
                example: 1
              endRow:
                type: integer
                example: 5
              multiplier:
                type: number
                example: 1.0
    Rating:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
          readOnly: true
        movieId:
          type: integer
          format: int64
          example: 123
        userId:
          type: integer
          format: int64
          example: 456
        rating:
          type: integer
          minimum: 1
          maximum: 10
          example: 9
        comment:
          type: string
          example: "Отличный фильм!"
        createdAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-10T14:25:30Z"
        updatedAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-10T14:25:30Z"
      required:
        - movieId
        - userId
        - rating

                
                